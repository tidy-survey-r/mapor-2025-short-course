### Set-up

#### Load necessary packages

```{r}
#| label: desc-ex-set-up
#| message: false
#| warning: false
library(tidyverse)
library(srvyr)
library(srvyrexploR)
```

#### Load in data and preview it

```{r}
#| label: desc-ex-data-summary
glimpse(anes_2020)
```

Find codebooks here:

  - [ANES 2024](https://electionstudies.org/wp-content/uploads/2025/08/anes_timeseries_2024_userguidecodebook_20250808.pdf)

#### Create design objects for usage

```{r}
#| label: desc-ex-design-obj
anes_des <- anes_2024 %>%
  filter(!is.na(V240108d)) |> 
  mutate(Weight = V240108b / sum(V240108b) * 232449541) %>%
  as_survey_design(
    weights = Weight,
    strata = V240108d,
    ids = V240108c,
    nest = TRUE
  )
```

### Exercises - Part 1

1. How many females have a graduate degree (according to the ANES data)?

```{r}
#| label: desc-sol-1-1
#| code-fold: true
#| code-summary: "Show code"
anes_des %>%
  # Optional filter
  filter(Sex == "2. Female", EducationGroup == "Graduate") %>%
  survey_count(Sex, EducationGroup)
```

1. What percentage of people identify as “Strong Democrat”? 

```{r}
#| label: desc-sol-1-2
#| code-fold: true
#| code-summary: "Show code"
anes_des %>%
  group_by(PartyID) %>%
  summarize(
    p = survey_prop()
  ) %>%
  # Optional filter
  filter(PartyID == "1. Strong Democrat")
```

1. What is the design effect for the proportion of people who voted early? 

```{r}
#| label: desc-sol-2-1
#| code-fold: true
#| code-summary: "Show code"

anes_des %>%
  filter(!is.na(EarlyVote2020)) %>%
  group_by(EarlyVote2020) %>%
  summarize(
    p = survey_mean(deff = TRUE)
  ) %>%
  filter(EarlyVote2020 == "Yes")
```

### Exercises - Part 2

1. What percentage of people who voted for president in the 2024 election identify as “Strong Republican”? 

```{r}
#| label: desc-sol-1-3
#| code-fold: true
#| code-summary: "Show code"
anes_des %>%
  filter(VotedPres2024 == "1. Yes, voted for President") %>%
  group_by(PartyID) %>%
  summarize(
    p = survey_prop()
  ) %>%
  # Optional filter
  filter(PartyID == "7. Strong Republican")
```

1. What percentage of people voted in both the 2024 election and the 2020 election? Include the logit confidence interval. 

```{r}
#| label: desc-sol-1-4
#| code-fold: true
#| code-summary: "Show code"
anes_des %>%
  filter(!is.na(VotedPres2024), !is.na(VotedPres2020)) %>%
  group_by(interact(VotedPres2020, VotedPres2024)) %>%
  summarize(
    p = survey_prop(vartype = "ci", prop_method = "logit")
  ) %>%
  filter(VotedPres2020 == "1. Yes, voted", VotedPres2024 == "1. Yes, voted for President")
```